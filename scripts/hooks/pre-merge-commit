#!/bin/bash

# Pre-merge-commit hook for codesearch project
# This hook prevents direct merges to the main branch

set -e

# Colors for output
RED='\033[0;31m'
YELLOW='\033[1;33m'
NC='\033[0m' # No Color

# Function to print colored output
print_status() {
    local color=$1
    local message=$2
    echo -e "${color}${message}${NC}"
}

# Check if we're trying to merge into main branch
current_branch=$(git symbolic-ref --short HEAD 2>/dev/null || echo "HEAD")
if [ "$current_branch" = "main" ]; then
    print_status $RED "‚ùå MERGE BLOCKED: Direct merges to main branch are not allowed!"
    print_status $YELLOW "Please use pull requests to merge into main branch."
    print_status $YELLOW "To merge a feature branch:"
    print_status $YELLOW "  1. Push your feature branch to remote"
    print_status $YELLOW "  2. Create a pull request"
    print_status $YELLOW "  3. Have it reviewed and approved"
    print_status $YELLOW "  4. Merge through the pull request interface"
    exit 1
fi